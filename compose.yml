services:
  backend:
    profiles: [ "backend", "app" ]
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: wetterdienst-backend:dev
    container_name: wetterdienst-backend
    restart: unless-stopped
    environment:
      # Common development env overrides; can be overridden in .env
      - PYTHONUNBUFFERED=1
    command: [ "wetterdienst", "restapi", "--listen", "0.0.0.0:3000" ]
    ports:
      - "3000:3000"
    develop:
      watch:
        - path: src/wetterdienst
          action: sync
          target: /app
        - path: ./pyproject.toml
          action: rebuild
        - path: ./uv.lock
          action: rebuild

  frontend:
    profiles: [ "frontend", "app" ]
    build:
      context: .
      dockerfile: docker/frontend.dev.Dockerfile
    image: wetterdienst-frontend:dev
    container_name: wetterdienst-frontend
    restart: unless-stopped
    environment:
      - HOST=0.0.0.0
      - PORT=4000
      - NUXT_PUBLIC_API_BASE=http://backend:3000/api
    ports:
      - "4000:4000"
    develop:
      watch:
        - path: frontend/package.json
          action: rebuild
        - path: frontend/pnpm-lock.yaml
          action: rebuild
        - path: frontend/
          action: sync
          target: /app
          ignore:
            - frontend/node_modules
            - frontend/.nuxt
            - frontend/.output
